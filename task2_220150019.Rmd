---
title: "Visualization of iris dataset using Dashboard and shiny"
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    social: menu
    source_code: https://github.com/walkerke/neighborhood_diversity
    theme: simplex
---

```{r setup, include=FALSE}
library(shiny)
library(plotly)
df <- datasets::iris
lookup <- structure(c(
  "Sepal Length vs Sepal Width" = "Sepal.Length_Sepal.Width",
  "Sepal Length vs Petal Length" = "Sepal.Length_Petal.Length",
  "Petal Length vs Petal Width" = "Petal.Length_Petal.Width",
  "Sepal Width vs Petal Width" = "Sepal.Width_Petal.Width"
))
lookup1 <- structure(c(
  "Boxplot of Sepal Length" = "Sepal.Length",
  "Boxplot of Sepal Width" = "Sepal.Width",
  "Boxplot of Petal Length" = "Petal.Length",
  "Boxplot of Petal Width" = "Petal.Width"
))



```

Sidebar {.sidebar}
======================================================================
```{r}
tags$br()
# Define inputs
selectInput('graph_name', label = 'Select the combination for scatterplots', choices = lookup, selected = "Sepal Length vs Sepal Width")
selectInput('box_name', label = 'Select the combination for boxplots', choices = lookup1, selected = "Sepal Length")
selectInput('kmeans_x', label = 'X coordinate for KMeans', choices = lookup1, selected = "Sepal Length")
selectInput('kmeans_y', label = 'Y coordinate for KMeans', choices = lookup1, selected = "Sepal Length")
```
Scatterplots
======================================================================

```{r scatterplot1, echo=FALSE}
output$scatterplot <- renderPlotly({
  # Access `input$graph_name` inside the reactive context
  selected_columns <- strsplit(input$graph_name, "_")[[1]]
  
  x_column <- selected_columns[1]
  y_column <- selected_columns[2]
  print(x_column)
  print(y_column)
  x1 <- strsplit(x_column, ".")
  x_1 = x1[1]
  x_11 = x1[2]
  y1 <- strsplit(y_column, ".")
  y_1 = y1[1]
  y_11 = y1[2]
  print(y_1)
  print(y_11)
  # Create the ggplot object
  p <- ggplot(df, aes_string(x = x_column, y = y_column, color = "Species")) +
    geom_point(alpha = 0.7) + # Scatter points
    labs(
      title = paste("Scatter Plot of", x_column, "vs", y_column),
      x = x_column,
      y = y_column
    ) +
    theme_minimal(base_size = 14)

  # Convert ggplot to an interactive plotly plot
  ggplotly(p)
})

# Render the plot
plotlyOutput('scatterplot', height = "500px")

```
Boxplots
======================================================================

```{r boxplots, echo=FALSE}
output$boxplot <- renderPlotly({
  y_column <- input$box_name
  print(y_column)
  
  # Create the ggplot object
  p <- ggplot(df, aes_string(x = "Species", y = y_column, fill = "Species")) +
    geom_boxplot(alpha = 0.7, outlier.color = "red", outlier.size = 2) + # Boxplot with custom outliers
    labs(
      title = paste("Boxplot of", y_column, "Grouped by Species"),
      x = "Species",
      y = y_column
    ) +
    theme_minimal(base_size = 14)

  # Convert ggplot to an interactive plotly plot
  ggplotly(p)
})

# Render the plot
plotlyOutput('boxplot', height = "500px")

```

KMeans
======================================================================

```{r kmeans, echo=FALSE}
output$kmeans_plot <- renderPlotly({
  # Dynamically select features for clustering based on input
  selected_features <- c(input$kmeans_x, input$kmeans_y)
  print(selected_features)
  
  # Perform K-means clustering
  kmeans_result <- kmeans(df[, selected_features], centers = 3)
  df$Cluster <- as.factor(kmeans_result$cluster)

  # Create the ggplot object
  p <- ggplot(df, aes_string(x = input$kmeans_x, y = input$kmeans_y, color = "Cluster", shape = "Species")) +
    geom_point(size = 3, alpha = 0.7) + # Clustered points
    labs(
      title = paste("K-Means Clustering of", input$kmeans_x, "vs", input$kmeans_y),
      x = input$kmeans_x,
      y = input$kmeans_y,
      color = "Cluster"
    ) +
    theme_minimal(base_size = 14)

  # Convert ggplot to an interactive plotly plot
  ggplotly(p)
})

# Render the plot
plotlyOutput('kmeans_plot', height = "500px")



